(function(h){if("undefined"==typeof jQuery)console.warn("[MvApi] requied jQuery. v1.7 이상");else{var e={debug:!1,installPage:"include",tcps:{key:"",secondIp:!1},server:{ip:"",port:0,secondIp:!1},company:{code:0,authKey:"",siteId:""},client:{encrypt:!1,windows:{product:"ezViewX"},mobile:{store:!0,scheme:"shezviewx",packagename:"com.saeha.ezViewX"},language:"",theme:1,btnType:1,appMode:0},agent:{port:{http:5555,https:5556},onlyHttps:!0},web:{url:"http://mv70.saeha.com"}};h.addEventListener("message",
function(a){a.data.multiview&&(e.debug&&console.debug("[MvApi] Event Message [",a.data.multiview,"]"),"close"==a.data.multiview.event&&($("#multiview_install").remove(),$("body").css("overflow","")))});var l={installGuide:function(){var a=e.web.url+"/program/installGuide.do?groupcode\x3d"+e.company.code+"\x26language\x3d"+e.client.language;if("popup"==e.installPage){var b,d;d=void 0!=h.screenTop?h.screenTop:screen.top;var c=h.innerHeight?h.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:
screen.height;b=(h.innerWidth?h.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-300+(void 0!=h.screenLeft?h.screenLeft:screen.left);d=c/2-475+d;c=[];c.push("width\x3d950");c.push("height\x3d600");d&&c.push("top\x3d"+d);b&&c.push("left\x3d"+b);c.push("toolbar\x3dno");c.push("menubar\x3dno");c.push("scrollbars\x3dno");c.push("resizable\x3dno");c.push("fullscreen\x3dno");c.push("fullscreen\x3dno");c.push("status\x3dno");c.push("titlebar\x3dno");h.open(a,
"multiview_install",c.join(","))}else"include"==e.installPage&&(b=$('\x3ciframe id\x3d"multiview_install" class\x3d"multiview_install" style\x3d"z-index: 99999; border: 0; position: fixed; left: 0; top: 0; width: 100%; height: 100%" scrolling\x3d"yes"\x3e\x3c/iframe\x3e'),b.attr("src",a),$("body").append(b).css("overflow","hidden"))},exec:function(a,b,d){a=a.platformType||"";a=""==a||void 0==a?k.platform:a.toUpperCase();"ANDROID"==a||"IOS"==a||"WINDOWS"==a?(location.href=e.web.url+"/program/download/"+
e.company.code+"/"+a+".do?language\x3d"+e.client.language,b()):d(f.NOT_SUPPORTED_DEVICE,a)}},f={NONE_REQUIRED_VALUE:"MVAPI-NONE_REQUIRED_VALUE",INVALID_VALUE:"MVAPI-INVALID_VALUE",NONE_TCPS_INFO:"MVAPI-NONE_TCPS_INFO",NONE_SERVER_INFO:"MVAPI-NONE_SERVER_INFO",NONE_COMPANY_INFO:"MVAPI-NONE_COMPANY_INFO",NOT_SUPPORTED_DEVICE:"EZVIEWAPI-NOT_SUPPORTED_DEVICE",NOT_CONNECTED_AGENT:"MVAPI-NOT_CONNECTED_AGENT",ALREADY_EXECUTE_PROGRAM:"MVAPI-ALREADY_EXECUTE_PROGRAM",WIN_CALL_ERROR:"MVAPI-WIN_CALL_ERROR",APP_CALL_ERROR:"MVAPI-APP_CALL_ERROR",
NOT_INSTALLED:"MVAPI-NOT_INSTALLED",UNDEFINED_ERROR:"MVAPI-UNDEFINED_ERROR"};"undefined"==typeof console&&(console={log:function(){},info:function(){},debug:function(){},error:function(){}});"undefined"==typeof console.log&&(console.log=function(){});"undefined"==typeof console.info&&(console.info=console.log);"undefined"==typeof console.debug&&(console.debug=console.log);"undefined"==typeof console.warn&&(console.warn=console.log);"undefined"==typeof console.error&&(console.error=console.log);var k=
{_userAgent:null,platformType:{Windows:"WINDOWS",Mac:"Macintosh",Android:"ANDROID",iOS:"IOS",Unknown:"UNKNOWN"},platform:null,ext:{chromeVersion:0,isNative:!1,isNaverApp:!1,isKakaoTalkApp:!1},parse:function(a){this._userAgent=a;null!=this._userAgent.match("Windows")?this.platform=this.platformType.Windows:null!=this._userAgent.match("Android")?this.platform=this.platformType.Android:null!=this._userAgent.match("iPhone")||null!=this._userAgent.match("iPad")?this.platform=this.platformType.iOS:null!=
this._userAgent.match("Mac")||null!=this._userAgent.match("Macintosh")?this.platform=this.platformType.Mac:this.platform=this.platformType.Unknown;try{this.ext.chromeVersion=parseFloat(this._userAgent.match(/Chrome\/[^\ ]*/)[0].toLowerCase().substr(7,2))}catch(b){}try{this.ext.isNative=null!=navigator.userAgent.match(/NATIVE/)}catch(b){}try{this.ext.isNaverApp=null!=navigator.userAgent.match(/NAVER/)}catch(b){}try{this.ext.isKakaoTalkApp=null!=navigator.userAgent.match(/KAKAOTALK/)}catch(b){}try{this.ext.isWebapp=
null!=navigator.userAgent.match(/WEBAPP/)}catch(b){}},isWindows:function(){return this.platform==this.platformType.Windows},isMac:function(){return this.platform==this.platformType.Mac},isMobile:function(){return this.platform==this.platformType.Android||this.platformType.iOS},isAndroid:function(){return this.platform==this.platformType.Android},isIos:function(){return this.platform==this.platformType.iOS}};k.parse(h.navigator.userAgent);var q={parameter:{command:"command",tcpsInfo:"tcpsInfo",serverInfo:"serverInfo",
companyInfo:"companyInfo",clientInfo:"clientInfo",confInfo:"confInfo",confOption:"confOption",confInfoEx:"confInfoEx",joinInfo:"joinInfo",userInfo:"userInfo",webInfo:"webInfo",webMessage:"webMessage"},make:function(a,b,d){var c=this,f=[];$.each(a,function(a,e){"function"==typeof c._parameterMaker[e]?f.push(c._parameterMaker[e].call(c,b,d)):console.warn("[MvApi] Unknown Parameter Key. ",e)});a=f.join("\x26");e.debug&&console.debug("[MvApi] Message: ",a);return a},_parameterMaker:{command:function(a){return this._makeKeyValue(this.parameter.command,
a)},tcpsInfo:function(a,b){return this._makeKeyValue(this.parameter.tcpsInfo,[e.tcps.key,e.tcps.secondIp?"1":"0"])},serverInfo:function(a,b){return this._makeKeyValue(this.parameter.serverInfo,[e.server.ip,e.server.port,e.server.secondIp?"1":"0"])},companyInfo:function(){return this._makeKeyValue(this.parameter.companyInfo,[e.company.code,e.company.authKey,e.company.siteId])},clientInfo:function(a,b){return this._makeKeyValue(this.parameter.clientInfo,[e.client.language,e.client.theme,e.client.btnType,
e.client.appMode])},confInfo:function(a,b){return this._makeKeyValue(this.parameter.confInfo,[b.roomCode,b.template,b.title,b.openOption])},confOption:function(a,b){if(void 0==b.roomOption)return null;if("object"==typeof b.roomOption){var d=[];$.each(b.roomOption,function(a,b){d.push(a+"\x3d"+b)});return this._makeKeyValue(this.parameter.confOption,d.join("\x26"))}return this._makeKeyValue(this.parameter.confOption,b.roomOption)},confInfoEx:function(a,b){return void 0==b.extraMsg?null:this._makeKeyValue(this.parameter.confInfoEx,
b.extraMsg)},joinInfo:function(a,b){return this._makeKeyValue(this.parameter.joinInfo,[b.roomCode,b.joinUserType])},userInfo:function(a,b){return this._makeKeyValue(this.parameter.userInfo,[e.company.code,e.company.authKey,0,b.userId,"",b.userName])},webInfo:function(a,b){return this._makeKeyValue(this.parameter.webInfo,e.web.url)},webMessage:function(a,b){return this._makeKeyValue(this.parameter.webMessage,b.webMessage)}},_makeKeyValue:function(a,b){var d=this;if("object"==typeof b){var c=[];$.each(b,
function(a,b){c.push(d._escape(b))});b=c.join("|")}else b=void 0==b?"":this._escape(b);return a+"\x3d"+b},_escape:function(a){"string"==typeof a&&(a=a.replace(/&/gi,String.fromCharCode(162)),a=a.replace(/=/gi,String.fromCharCode(163)),a=a.replace(/[|]/gi,String.fromCharCode(164)));return a}},m={_ajaxOptions:{type:"post",dataType:"json",async:!0,cache:!1,timeout:1E4},running:function(a,b){var d=this,c=$.extend({},this._ajaxOptions);c.url=this._makeHost();c.data={COMMAND:"running",PRODUCTNAME:e.client.windows.product};
c.success=function(c){c.RETURN==d._retuenCode.CLIENT_NOT_RUNNING?a():c.RETURN==d._retuenCode.CLIENT_RUNNING?b(f.ALREADY_EXECUTE_PROGRAM,c.RETURN):b(f.UNDEFINED_ERROR,c.RETURN)};c.error=function(a,c,d){0==a.readyState&&b(f.NOT_CONNECTED_AGENT);l.installGuide()};$.ajax(c)},exec:function(a,b,d){var c=this,g=$.extend({},this._ajaxOptions);g.url=this._makeHost();g.data={COMMAND:"exec",PRODUCTNAME:e.client.windows.product,EXECMSG:encodeURIComponent(a)};g.success=function(a){a.RETURN==c._retuenCode.OK||
a.RETURN==c._retuenCode.CLIENT_MISS_VERSION?b():a.RETURN==c._retuenCode.WA_UNKNOWN_PARAMETER||a.RETURN==c._retuenCode.CLIENT_FAIL?d(f.WIN_CALL_ERROR,a.RETURN):a.RETURN==c._retuenCode.CLIENT_NO_ANSWER?(d(f.NOT_INSTALLED,a.RETURN),l.installGuide()):a.RETURN==c._retuenCode.CLIENT_FAIL_ALREADYEXIST?d(f.ALREADY_EXECUTE_PROGRAM,a.RETURN):d(f.UNDEFINED_ERROR,a.RETURN)};g.error=function(a,b,c){0==a.readyState&&d(f.NOT_CONNECTED_AGENT);l.installGuide()};$.ajax(g)},_makeHost:function(){var a=e.agent.onlyHttps?
"https:":widows.location.protocol;return a+"//127.0.0.1:"+(e.agent.onlyHttps?e.agent.port.https:"http:"==a?e.agent.port.http:e.agent.port.https)+"/mvAgent"},_retuenCode:{OK:"OK",WA_MISS_VERSION:"WA_MISS_VERSION",WA_UNKNOWN_PARAMETER:"WA_UNKNOWN_PARAMETER",CLIENT_NO_ANSWER:"CLIENT_NO_ANSWER",CLIENT_MISS_VERSION:"CLIENT_MISS_VERSION",CLIENT_FAIL_ALREADYEXIST:"CLIENT_FAIL_ALREADYEXIST",CLIENT_MISS_PASSWORD:"CLIENT_MISS_PASSWORD",CLIENT_FAIL:"CLIENT_FAIL",OK_BANISHFORCE:"OK_BANISHFORCE",OK_CLOSURE:"OK_CLOSURE",
CLIENT_RUNNING:"CLIENT_RUNNING",CLIENT_NOT_RUNNING:"CLIENT_NOT_RUNNING"}},n={exec:function(a,b,d){if(k.ext.isNative)this._toApp(a,b,d);else if(k.ext.isWebapp)this._toWebapp(a,b,d);else if(k.isAndroid()){var c=[];c.push("intent://mv?"+a+"#Intent");c.push("scheme\x3d"+e.client.mobile.scheme);c.push("action\x3dandroid.intent.action.VIEW;category\x3dandroid.intent.category.BROWSABLE");e.client.mobile.store&&k.ext.isKakaoTalkApp&&c.push("package\x3d"+e.client.mobile.packagename);c.push("end");this._exec_android(c.join(";"),
b,d)}else if(k.isIos()||k.isMac())c=e.client.mobile.scheme+"://mv?"+a,this._exec_ios(c,b,d)},_toApp:function(a,b,d){e.debug&&console.debug("[MvApi] toApp.");try{if(k.isAndroid())h.callbackHandler.postMessage(a),b();else if(k.isIos()||k.isMac())webkit.messageHandlers.callbackHandler.postMessage(a),b()}catch(c){console.error(c),d(f.APP_CALL_ERROR,c)}},_toWebapp:function(a,b,d){a=e.client.mobile.scheme+"://mv?"+a;e.debug&&console.debug("[MvApi] toWebapp. scheme:"+a);h.location.href=a;b()},_exec_android:function(a,
b,d){e.debug&&console.debug("[MvApi] Android Scheme [",a,"]",k.ext.chromeVersion);if(e.client.mobile.store)if(k.ext.isKakaoTalkApp){var c=h.open();c?(c.location.href=a,setTimeout(function(){c.closed?b():(c.close(),l.installGuide(),d(f.NOT_INSTALLED))},1E3)):alert(e.localeMessage.allowPopup)}else{h.location.href=a;var g=+new Date;setTimeout(function(){1200>new Date-g?(l.installGuide(),d(f.NOT_INSTALLED)):b()},1E3)}else if(42<=k.ext.chromeVersion)h.location.href=a,g=+new Date,setTimeout(function(){1200>
new Date-g?(l.installGuide(),d(f.NOT_INSTALLED)):b()},1E3);else if(25<=k.ext.chromeVersion)(c=h.open())?(c.location.href=a,setTimeout(function(){c.closed?b():(c.close(),l.installGuide(),d(f.NOT_INSTALLED))},1E3)):alert("팝업을 허용하고 다시 시도해 주세요.");else{var p=$("\x3ciframe\x3e\x3c/iframe\x3e",{id:"appSchemeCheckFrame",src:a,width:0,height:0}).css({border:"0",display:"none"}).appendTo("body");setTimeout(function(){var a=p.contents().find("body").html();null==a||""==a||void 0==a?(l.installGuide(),d(f.NOT_INSTALLED)):
b()},2E3)}},_exec_ios:function(a,b,d){e.debug&&console.debug("[MvApi] iOS Scheme [",a,"]");var c=+new Date;setTimeout(function(){2E3>+new Date-c?(l.installGuide(),d(f.NOT_INSTALLED)):b()},1500);0<parent.window.frames.length?parent.window.location.href=a:h.location.href=a}},r={leadingZeros:function(a,b){var d="";a=a.toString();if(b>a.length)for(var c=0;b-a.length>c;c++)d+="0";return d+a}},g={api:{running:{name:"running",parameters:["command"]},open:{name:"open",parameters:"command tcpsInfo serverInfo companyInfo clientInfo confInfo confOption userInfo webInfo confInfoEx".split(" ")},
openJoin:{name:"openJoin",parameters:"command tcpsInfo serverInfo companyInfo clientInfo confInfo confOption joinInfo userInfo webInfo confInfoEx".split(" ")},join:{name:"join",parameters:"command tcpsInfo serverInfo companyInfo clientInfo joinInfo userInfo webInfo confInfoEx".split(" ")},close:{name:"close",parameters:"command tcpsInfo serverInfo companyInfo clientInfo confInfo userInfo webInfo".split(" ")},quit:{name:"quit",parameters:"command tcpsInfo serverInfo companyInfo clientInfo confInfo userInfo webInfo".split(" ")},
avset:{name:"avset",parameters:["command","clientInfo"]},downloadClient:{name:"downloadClient",parameters:null},logout:{name:"logout",parameters:["command","clientInfo"]},relogin:{name:"relogin",parameters:["command","clientInfo"]},webMessage:{name:"webMessage",parameters:["command","webMessage"]}},_validation:function(a,b,d){if(void 0==e.tcps.key||""==e.tcps.key)return console.warn("[MvApi] tcps.key is required."),d(f.NONE_TCPS_INFO,"tcps.key"),!1;void 0!=e.server.ip&&""!=e.server.ip||console.warn("[MvApi] server.ip is required.");
void 0!=e.server.port&&0!=e.server.port||console.warn("[MvApi] server.port is required.");if(void 0==e.company.code||2>e.company.code)return console.warn("[MvApi] company.code is required."),d(f.NONE_COMPANY_INFO,"company.code"),!1;if(void 0==e.company.authKey||""==e.company.authKey)return console.warn("[MvApi] company.authKey is required."),d(f.NONE_COMPANY_INFO,"company.authKey"),!1;if(void 0!==e.company.siteId&&""!==e.company.siteId){var c=Number(e.company.siteId);if(!c||0>c)return console.warn("[MvApi] company.siteId is invalid. (only Number)"),
d(f.INVALID_VALUE,"company.siteId"),!1;e.company.siteId=c}if(a.name==this.api.open.name||a.name==this.api.openJoin.name||a.name==this.api.join.name||a.name==this.api.close.name){if(void 0==b.roomCode||""==b.roomCode)return console.warn("[MvApi] roomCode is required."),d(f.NONE_REQUIRED_VALUE,"roomCode"),!1;if(!e.client.encrypt){if(32<b.roomCode.length)return console.warn("[MvApi] roomCode is invalid. (max length: 32)"),d(f.INVALID_VALUE,"roomCode"),!1;var c=r.leadingZeros(e.company.code,6),g=b.roomCode.substr(0,
6);if(c!=g)return console.warn("[MvApi] roomCode is invalid. (prefix not match companyCode)"),d(f.INVALID_VALUE,"roomCode"),!1}}if(a.name==this.api.open.name||a.name==this.api.openJoin.name){if(void 0===b.template||""===b.template)return console.warn("[MvApi] template is required."),d(f.NONE_REQUIRED_VALUE,"template"),!1;c=Number(b.template);if(!c||0>c)return console.warn("[MvApi] template is invalid. (only Number)"),d(f.INVALID_VALUE,"template"),!1;b.template=c}if(a.name==this.api.open.name||a.name==
this.api.openJoin.name){if(void 0==b.title||""==b.title)return console.warn("[MvApi] title is required."),d(f.NONE_REQUIRED_VALUE,"title"),!1;if(128<b.title.length)return console.warn("[MvApi] title is invalid. (max length: 128)"),d(f.INVALID_VALUE,"title"),!1}if(a.name==this.api.openJoin.name){if(void 0==b.openOption||""==b.openOption)b.openOption=0;c=Number(b.openOption);if(0>c||1<c)return console.warn("[MvApi] openOption is invalid. (range: 0~1)"),d(f.INVALID_VALUE,"openOption"),!1;b.openOption=
c}if(a.name==this.api.open.name||a.name==this.api.openJoin.name||a.name==this.api.join.name){if(void 0==b.joinUserType||""==b.joinUserType)b.joinUserType=1;c=Number(b.joinUserType);if(0>=c||20<c)return console.warn("[MvApi] joinUserType is invalid. (range: 1~20)"),d(f.INVALID_VALUE,"joinUserType"),!1;b.joinUserType=c}if(a.name==this.api.open.name||a.name==this.api.openJoin.name||a.name==this.api.join.name||a.name==this.api.close.name||a.name==this.api.quit.name){if(void 0==b.userId||""==b.userId)return console.warn("[MvApi] userId is required."),
d(f.NONE_REQUIRED_VALUE,"userId"),!1;if(!e.client.encrypt&&32<b.userId.length)return console.warn("[MvApi] userId is invalid. (max length: 32)"),d(f.INVALID_VALUE,"userId"),!1}if(a.name==this.api.open.name||a.name==this.api.openJoin.name||a.name==this.api.join.name||a.name==this.api.close.name||a.name==this.api.quit.name){if(void 0==b.userName||""==b.userName)return console.warn("[MvApi] userName is required."),d(f.NONE_REQUIRED_VALUE,"userName"),!1;if(!e.client.encrypt&&32<b.userName.length)return console.warn("[MvApi] userName is invalid. (max length: 32)"),
d(f.INVALID_VALUE,"userName"),!1}return!0},call:function(a,b,d,c){d||(d=function(){console.info("[MvApi] success.")});c||(c=function(a,b){console.error("[MvApi] error. errorCode: ",a,b)});b=this._requestMsg_convert(b);this._validation(a,b,c)&&(a.name==g.api.downloadClient.name?l.exec(b,d,c):a.name==g.api.running.name?k.isWindows()?m.running(d,c):d():(a=q.make(a.parameters,a.name,b),k.isWindows()?m.exec(a,d,c):k.isMac()?n.exec(a,d,c):k.isMobile()?n.exec(a,d,c):console.warn("[MvApi] Not Supported Device.")))},
_requestMsg_convert:function(a){void 0==a.roomCode&&void 0!=a.roomcode&&(a.roomCode=a.roomcode);void 0==a.userId&&void 0!=a.userid&&(a.userId=a.userid);void 0==a.userName&&void 0!=a.username&&(a.userName=a.username);return a}};h.MvApi={VERSION:"7.1.5.4",defaultSettings:function(a){if("undefined"!=typeof a&&"object"!=typeof a)return console.error("[MvApi] argument type only Object. input type: "+typeof a),e;$.extend(!0,e,a);e.debug&&console.debug("[MvApi] settings: ",e);return e},runCheck:function(a,
b,d){console.info("[MvApi] running");g.call(g.api.running,a,b,d)},open:function(a,b,d){console.info("[MvApi] open");g.call(g.api.open,a,b,d)},openJoin:function(a,b,d){console.info("[MvApi] openJoin");g.call(g.api.openJoin,a,b,d)},join:function(a,b,d){console.info("[MvApi] join");g.call(g.api.join,a,b,d)},close:function(a,b,d){console.info("[MvApi] close");g.call(g.api.close,a,b,d)},quit:function(a,b,d){console.info("[MvApi] quit");g.call(g.api.quit,a,b,d)},avset:function(a,b,d){console.info("[MvApi] avset");
"function"==typeof a&&(d=b,b=a);g.call(g.api.avset,{},b,d)},downloadClient:function(a,b,d){console.info("[MvApi] downloadClient");g.call(g.api.downloadClient,a,b,d)},logout:function(a,b,d){console.info("[MvApi] logout");g.call(g.api.logout,{},b,d)},relogin:function(a,b,d){console.info("[MvApi] relogin");g.call(g.api.relogin,{},b,d)},webMessage:function(a,b,d){console.info("[MvApi] webMessage");g.call(g.api.webMessage,a,b,d)}}}})(window);